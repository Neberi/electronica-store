{% extends 'admin_panel/base.html' %}

{% block title %}–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ó–∞–∫–∞–∑ #{{ order.order_number }}{% endblock %}

{% block page_title %}üì¶ –ó–∞–∫–∞–∑ #{{ order.order_number }}{% endblock %}

{% block content %}
<div class="row" style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
    <div>
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ -->
        <div class="card" style="background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="margin-top: 0;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h3>
            <table style="width: 100%;">
                <tr>
                    <td><strong>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</strong></td>
                    <td>#{{ order.order_number }}</td>
                </tr>
                <tr>
                    <td><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong></td>
                    <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>
                </tr>
                <tr>
                    <td><strong>–°—Ç–∞—Ç—É—Å:</strong></td>
                    <td>
                        <span class="status-badge status-{{ order.status }}">
                            {{ order.get_status_display }}
                        </span>
                    </td>
                </tr>
                <tr>
                    <td><strong>–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤:</strong></td>
                    <td>{{ order.total_amount }} ‚ÇΩ</td>
                </tr>
                <tr>
                    <td><strong>–î–æ—Å—Ç–∞–≤–∫–∞:</strong></td>
                    <td>{{ order.delivery_cost }} ‚ÇΩ</td>
                </tr>
                {% if order.promo_discount %}
                <tr>
                    <td><strong>–°–∫–∏–¥–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É:</strong></td>
                    <td>-{{ order.promo_discount_amount }} ‚ÇΩ ({{ order.promo_discount }}%)</td>
                </tr>
                {% endif %}
                <tr>
                    <td><strong>–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞:</strong></td>
                    <td><strong style="font-size: 1.2rem;">{{ order.final_amount }} ‚ÇΩ</strong></td>
                </tr>
            </table>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
        <div class="card" style="background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="margin-top: 0;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ</h3>
            <table style="width: 100%;">
                <tr>
                    <td><strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong></td>
                    <td>{{ order.user.username }}</td>
                </tr>
                <tr>
                    <td><strong>Email:</strong></td>
                    <td>{{ order.user.email }}</td>
                </tr>
                <tr>
                    <td><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong></td>
                    <td>{{ order.phone }}</td>
                </tr>
                <tr>
                    <td><strong>–†–µ–≥–∏–æ–Ω:</strong></td>
                    <td>{{ order.region }}</td>
                </tr>
                <tr>
                    <td><strong>–ê–¥—Ä–µ—Å:</strong></td>
                    <td>{{ order.address }}</td>
                </tr>
            </table>
        </div>

        <!-- –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ -->
        <div class="card" style="background: white; padding: 25px; border-radius: 12px;">
            <h3 style="margin-top: 0;">–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ</h3>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>–¢–æ–≤–∞—Ä</th>
                        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–°—É–º–º–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items.all %}
                    <tr>
                        <td>{{ item.product_name }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>{{ item.price }} ‚ÇΩ</td>
                        <td>{{ item.total }} ‚ÇΩ</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div>
        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div class="card" style="background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
            <h3 style="margin-top: 0;">–î–µ–π—Å—Ç–≤–∏—è</h3>

            <div style="margin-bottom: 15px;">
                <strong>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å:</strong>
                <select onchange="updateOrderStatus('{{ order.id }}', this.value)"
                        class="form-control" style="margin-top: 10px;">
                    {% for key, value in STATUS_CHOICES %}
                    <option value="{{ key }}" {% if order.status == key %}selected{% endif %}>
                        {{ value }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div style="margin-bottom: 15px;">
                <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ:</strong>
                <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                    {{ order.address }}<br>
                    {{ order.region }}<br>
                    üìû {{ order.phone }}
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <strong>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</strong>
                <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px;">
                    {{ order.get_payment_method_display }}
                    {% if order.promo_code %}
                    <br>–ü—Ä–æ–º–æ–∫–æ–¥: <strong>{{ order.promo_code }}</strong>
                    {% endif %}
                </div>
            </div>

            <form action="{% url 'main:delete_order' order.id %}" method="post"
                  class="delete-form" style="margin-top: 20px;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger"
                        onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ #{{ order.order_number }}?')">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑
                </button>
            </form>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ -->
        <div class="card" style="background: white; padding: 25px; border-radius: 12px;">
            <h3 style="margin-top: 0;">–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤</h3>
            <div style="margin-top: 10px;">
                <div style="border-left: 3px solid #3498db; padding-left: 15px; margin-bottom: 15px;">
                    <strong>–°–æ–∑–¥–∞–Ω:</strong><br>
                    {{ order.created_at|date:"d.m.Y H:i" }}
                </div>
                <div style="border-left: 3px solid #3498db; padding-left: 15px; margin-bottom: 15px;">
                    <strong>–û–±–Ω–æ–≤–ª–µ–Ω:</strong><br>
                    {{ order.updated_at|date:"d.m.Y H:i" }}
                </div>
                {% if order.status == 'delivered' %}
                <div style="border-left: 3px solid #27ae60; padding-left: 15px; margin-bottom: 15px;">
                    <strong>–î–æ—Å—Ç–∞–≤–ª–µ–Ω:</strong><br>
                    –î–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div style="margin-top: 30px;">
    <a href="{% url 'main:admin_orders' %}" class="btn btn-primary">
        ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∑–∞–∫–∞–∑–æ–≤
    </a>
</div>
{% endblock %}