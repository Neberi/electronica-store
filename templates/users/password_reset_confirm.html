{% extends 'base.html' %}

{% block title %}–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å - Electronica Store{% endblock %}

{% block content %}
<div class="header-nav">
    <a href="{% url 'main:index' %}" class="nav-link">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
</div>

<div class="auth-container">
    <div class="auth-card">
        <div class="auth-decoration">
            <div class="auth-icon">üîê</div>
        </div>

        <h1 class="auth-title">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è</h1>
        <p class="auth-subtitle">–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞</p>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <form method="post" class="auth-form">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="alert alert-error">
                ‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –Ω–∏–∂–µ.
            </div>
            {% endif %}

            <div class="form-group">
                <label for="id_new_password1" class="form-label">
                    üîí –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
                </label>
                {{ form.new_password1 }}
                {% if form.new_password1.errors %}
                <div class="error-text">
                    {{ form.new_password1.errors }}
                </div>
                {% endif %}
                <small class="form-help">‚Ä¢ –ù–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤</small>
                <div class="password-strength">
                    <div class="strength-bar strength-weak"></div>
                </div>
            </div>

            <div class="form-group">
                <label for="id_new_password2" class="form-label">
                    üîí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
                </label>
                {{ form.new_password2 }}
                {% if form.new_password2.errors %}
                <div class="error-text">
                    {{ form.new_password2.errors }}
                </div>
                {% endif %}
                <small class="form-help">‚Ä¢ –í–≤–µ–¥–∏—Ç–µ —Ç–æ—Ç –∂–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</small>
            </div>

            <button type="submit" class="auth-button">
                üîÑ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
            </button>
        </form>

        <div class="auth-links">
            <p><a href="{% url 'users:login' %}" class="auth-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É</a></p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const password1 = document.getElementById('id_new_password1');
    const password2 = document.getElementById('id_new_password2');
    const strengthBar = document.querySelector('.strength-bar');

    function checkPasswordStrength(password) {
        let strength = 0;

        if (password.length >= 8) strength += 1;
        if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength += 1;
        if (password.match(/\d/)) strength += 1;
        if (password.match(/[^a-zA-Z\d]/)) strength += 1;

        return strength;
    }

    function updateStrengthBar(strength) {
        strengthBar.className = 'strength-bar';

        if (strength === 0) {
            strengthBar.classList.add('strength-weak');
        } else if (strength <= 2) {
            strengthBar.classList.add('strength-medium');
        } else {
            strengthBar.classList.add('strength-strong');
        }
    }

    if (password1) {
        password1.addEventListener('input', function() {
            const strength = checkPasswordStrength(this.value);
            updateStrengthBar(strength);
        });
    }

    if (password2 && password1) {
        password2.addEventListener('input', function() {
            if (this.value !== password1.value) {
                this.classList.add('error');
            } else {
                this.classList.remove('error');
                this.classList.add('success');
            }
        });
    }
});
</script>
{% endblock %}